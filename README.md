## Enhanced Logger

è¿™æ˜¯ä¸€ä¸ªåŸºäº [Loguru](https://github.com/Delgan/loguru) çš„æ‰©å±•æ—¥å¿—è®°å½•å™¨ï¼Œæä¾›äº†ä¸€ç³»åˆ—å¢å¼ºç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š

- è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼  
- æ—¥å¿—è½®è½¬å’Œä¿ç•™ç­–ç•¥  
- ä¸Šä¸‹æ–‡ä¿¡æ¯ç®¡ç†ï¼ˆå¦‚ `request_id`ï¼‰  
- è¿œç¨‹æ—¥å¿—æ”¶é›†ï¼ˆä½¿ç”¨çº¿ç¨‹æ± é˜²æ­¢é˜»å¡ï¼‰  
- è£…é¥°å™¨ç”¨äºè®°å½•å‡½æ•°è°ƒç”¨å’Œæ‰§è¡Œæ—¶é—´ï¼Œæ”¯æŒåŒæ­¥/å¼‚æ­¥å‡½æ•°  
- è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«ï¼ˆé¿å…ä¸ Loguru é¢„å®šä¹‰çš„å†²çªï¼‰  
- ç»Ÿä¸€å¼‚å¸¸å¤„ç†  

---

### åŠŸèƒ½æ¦‚è¿°

1. **è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼**  
   å¯è‡ªç”±é…ç½®å­—æ®µï¼Œå¦‚æ—¶é—´ã€è¿›ç¨‹/çº¿ç¨‹ IDã€æ—¥å¿—çº§åˆ«ã€è¯·æ±‚ IDã€æ‰€åœ¨æ–‡ä»¶ã€å‡½æ•°ã€è¡Œå·ç­‰ã€‚

2. **æ—¥å¿—è½®è½¬ä¸ä¿ç•™**  
   - æ”¯æŒæŒ‰ç…§æ–‡ä»¶å¤§å°ã€æ—¶é—´æˆ–æ–‡ä»¶æ•°é‡è¿›è¡Œæ»šåŠ¨ï¼Œå¹¶å¯è‡ªåŠ¨åˆ é™¤è¿‡æœŸæ—¥å¿—ã€‚  
   - é»˜è®¤ä½¿ç”¨å¤§å°è½®è½¬ï¼šå•ä¸ªæ–‡ä»¶è¶…è¿‡ `max_size` MB æ—¶è‡ªåŠ¨æ»šåŠ¨ã€‚  
   - é»˜è®¤ä¿ç•™ç­–ç•¥ `retention='9 days'`ï¼Œå¯æ ¹æ®éœ€è¦è‡ªå®šä¹‰ã€‚

3. **ä¸Šä¸‹æ–‡ç®¡ç†**  
   - ä½¿ç”¨ `ContextVar` å‚¨å­˜ `request_id`ï¼Œå¯åœ¨å¼‚æ­¥ç¯å¢ƒä¸­åŒºåˆ†ä¸åŒè¯·æ±‚æ¥æºçš„æ—¥å¿—ã€‚

4. **è¿œç¨‹æ—¥å¿—æ”¶é›†**  
   - é€šè¿‡è‡ªå®šä¹‰å¤„ç†å™¨ï¼Œä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼å°†æ—¥å¿—ä¸ŠæŠ¥åˆ°è¿œç¨‹æœåŠ¡ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡ã€‚  
   - é»˜è®¤ä»…æ”¶é›† `ERROR` åŠä»¥ä¸Šç­‰çº§çš„æ—¥å¿—ã€‚å¯åœ¨ `_configure_remote_logging()` æ–¹æ³•ä¸­è‡ªè¡Œé…ç½®ã€‚

5. **è£…é¥°å™¨**  
   - `log_decorator` å¯è£…é¥°ä»»æ„åŒæ­¥æˆ–å¼‚æ­¥å‡½æ•°ï¼Œè‡ªåŠ¨è®°å½•ï¼š
     - å‡½æ•°è°ƒç”¨å¼€å§‹  
     - å‚æ•°ã€è¿”å›å€¼  
     - å‡½æ•°æ‰§è¡Œè€—æ—¶  
     - å¼‚å¸¸ä¿¡æ¯ï¼ˆå¯é€‰æ‹©æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼‰

6. **è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«**  
   - é€šè¿‡ `add_custom_level` æ–¹æ³•æ·»åŠ é¢å¤–çš„æ—¥å¿—çº§åˆ«ï¼ˆå¦‚ `AUDIT`, `SECURITY` ç­‰ï¼‰ï¼Œé¿å…ä¸å·²æœ‰æ—¥å¿—çº§åˆ«å†²çªã€‚

7. **ç»Ÿä¸€å¼‚å¸¸å¤„ç†**  
   - æ³¨å†Œå…¨å±€å¼‚å¸¸å¤„ç† (`sys.excepthook`)ï¼Œæ•è·ä»»ä½•æœªå¤„ç†çš„å¼‚å¸¸å¹¶è®°å½•ã€‚

---

### ç›®å½•ç»“æ„

. â”œâ”€â”€ logs/ # æ—¥å¿—å­˜æ”¾ç›®å½•ï¼ˆé»˜è®¤ï¼‰ â”œâ”€â”€ my_logger.py # MyLogger ç±»æºç  â”œâ”€â”€ README.md # ä½¿ç”¨è¯´æ˜ â””â”€â”€ requirements.txt # Pythonä¾èµ–ï¼ˆå¦‚æœ‰ï¼‰

yaml
å¤åˆ¶ä»£ç 

> å…¶ä¸­ `logs/` æ˜¯é»˜è®¤æ—¥å¿—ç›®å½•ï¼Œå¯ä»¥é€šè¿‡åˆå§‹åŒ–æ—¶çš„ `log_dir` å‚æ•°ä¿®æ”¹ã€‚

---


### å®‰è£…

```bash
pip install xdeek-logger
```


### ä½¿ç”¨ç¤ºä¾‹
    example/main.py


### å¯¼å…¥å¹¶ä½¿ç”¨

```
from xdeek_logger import MyLogger

"""
åˆå§‹åŒ–æ—¥å¿—è®°å½•å™¨
å¯è‡ªå®šä¹‰:
  - ä¸»æ—¥å¿—æ–‡ä»¶å (e.g., "app_log")
  - æ—¥å¿—ç›®å½• log_dir (é»˜è®¤ "logs")
  - å•ä¸ªæ—¥å¿—æ–‡ä»¶ä½“ç§¯æœ€å¤§å€¼ max_size (MB)
  - æ—¥å¿—ä¿ç•™ç­–ç•¥ retention (e.g., "7 days")
  - è¿œç¨‹æ—¥å¿—æ”¶é›†åœ°å€ remote_log_url (é»˜è®¤ None)
  - çº¿ç¨‹æ± æœ€å¤§å·¥ä½œçº¿ç¨‹æ•° max_workers (é»˜è®¤ 5)
"""
logger = MyLogger(
    file_name="app_log",
    log_dir="logs",
    max_size=50,
    retention="7 days",
    remote_log_url=None,
    max_workers=5
)

```

### è°ƒç”¨æ—¥å¿—æ–¹æ³•

```
"""ç›´æ¥ä½¿ç”¨ Loguru çš„å¸¸è§æ—¥å¿—æ–¹æ³•"""
logger.info("This is an info message.")
logger.debug("Debug details here.")
logger.warning("Be cautious!")
logger.error("An error occurred.")
logger.critical("Critical issue!")
logger.trace("This is a trace message - only if Loguru TRACE level is enabled.")

"""å¢åŠ è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«"""
logger.add_custom_level("CUSTOM_LEVEL", no=15, color="<magenta>", icon="ğŸŒŸ")
logger.log("CUSTOM_LEVEL", "A special custom message.")

```

### ä½¿ç”¨è£…é¥°å™¨è®°å½•å‡½æ•°è°ƒç”¨

```
@logger.log_decorator("A division error occurred.")
def divide(a, b):
    return a / b

try:
    result = divide(10, 0)  
    """# å°†è§¦å‘ ZeroDivisionError"""
except ZeroDivisionError:
    logger.exception("Handled ZeroDivisionError.")

```
- æ­¤è£…é¥°å™¨ä¼šè‡ªåŠ¨åœ¨å‡½æ•°å¼€å§‹å’Œç»“æŸæ—¶åˆ†åˆ«è®°å½•å‡½æ•°åã€å‚æ•°ã€è¿”å›å€¼ä»¥åŠè€—æ—¶ã€‚
- å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è®°å½• traceback å¹¶æ‰“å°è‡ªå®šä¹‰æç¤ºä¿¡æ¯ã€‚


### è®°å½•å¼‚æ­¥å‡½æ•°è°ƒç”¨

```
import asyncio

@logger.log_decorator("Async function error.")
async def async_task():
    await asyncio.sleep(1)
    return "Async result"

async def main():
    result = await async_task()
    logger.info(f"Result: {result}")

asyncio.run(main())

```

### è®¾ç½®å’Œé‡ç½® request_id

```
"""# è®¾ç½®æŸä¸ªä¸Šä¸‹æ–‡çš„ request_id"""
token = logger.request_id_var.set("12345")

"""# ...æ‰§è¡Œä¸ä½ çš„è¯·æ±‚ç›¸å…³çš„æ“ä½œï¼Œæ‰€æœ‰æ—¥å¿—éƒ½å¸¦ä¸Š request_id=12345"""

"""# ç»“æŸåé‡ç½®"""
logger.request_id_var.reset(token)

``` 


### è¿œç¨‹æ—¥å¿—æ”¶é›†

- åœ¨åˆå§‹åŒ– MyLogger æ—¶ï¼ŒæŒ‡å®š remote_log_url å³å¯å¯ç”¨è¿œç¨‹æ—¥å¿—ä¸ŠæŠ¥åŠŸèƒ½ï¼š

```
logger = MyLogger(
    file_name="app_log",
    remote_log_url="https://your-logging-endpoint.com/logs"
)

``` 





### å¸¸è§é—®é¢˜

#### 1. å¦‚ä½•å…³é—­æ—¥å¿—å¤šæ–‡ä»¶ç­–ç•¥ï¼Ÿ
- å¦‚æœä»…éœ€è¦ä¸€ä¸ªä¸»æ—¥å¿—æ–‡ä»¶ï¼Œå¯å»æ‰æˆ–æ³¨é‡Šæ‰ `_get_level_log_path()` ç›¸å…³çš„ `logger.add(...)` è°ƒç”¨ã€‚
- å¦‚æœå¸Œæœ›â€œåªæŒ‰çº§åˆ«åˆ†æ–‡ä»¶ã€ä¸éœ€è¦ä¸»æ—¥å¿—æ–‡ä»¶â€ï¼Œå¯ä»¥åˆ é™¤å¯¹åº”çš„æ·»åŠ ä¸»æ—¥å¿—æ–‡ä»¶çš„ `add` è°ƒç”¨ã€‚

#### 2. å¦‚ä½•è‡ªå®šä¹‰è½®è½¬ç­–ç•¥ï¼ˆæŒ‰å¤©ã€æŒ‰å°æ—¶ç­‰ï¼‰ï¼Ÿ
- å°† `rotation=f"{self.max_size} MB"` æ”¹ä¸º `rotation="1 day"`ã€`rotation="00:00"` ç­‰ï¼Œå³å¯ä½¿ç”¨ Loguru çš„æ—¶é—´è½®è½¬åŠŸèƒ½ã€‚

#### 3. å¦‚ä½•è‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼Ÿ
- ä¿®æ”¹ `custom_format` å˜é‡ï¼Œæˆ–åœ¨ `logger.add()` ä¸­ä½¿ç”¨ä½ å–œæ¬¢çš„æ ¼å¼ï¼Œå¦‚ **JSON** æ ¼å¼ã€å•è¡Œç®€æ´æ ¼å¼ç­‰ã€‚

#### 4. å¦‚ä½•åœ¨å‡½æ•°è£…é¥°å™¨ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Ÿ
- åœ¨è£…é¥°å™¨é‡Œæ•è·å¼‚å¸¸åï¼Œå¦‚æœå¸Œæœ›è£…é¥°å™¨å†…ä¸â€œåæ‰â€å¼‚å¸¸ï¼Œå¯åœ¨ `except` å—é‡Œæ·»åŠ  `raise`ï¼Œè¿™æ ·å¼‚å¸¸ä¼šç»§ç»­å‘ä¸Šä¼ é€’ã€‚

#### 5. å¦‚ä½•å¢åŠ æ›´å¤šè‡ªå®šä¹‰æ—¥å¿—çº§åˆ«ï¼Ÿ
- ä½¿ç”¨ `add_custom_level("AUDIT", no=21, color="<blue>", icon="ğŸ‘®")` æ¥æ·»åŠ ï¼›å‚æ•°å«ä¹‰ï¼š
  - `no`ï¼šæ•°å€¼ç­‰çº§ï¼ˆè¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ï¼‰ï¼Œä¸€å®šè¦ä¸å·²æœ‰çº§åˆ«æˆ–å…¶ä»–è‡ªå®šä¹‰çº§åˆ«ä¸åŒã€‚
  - `color`ï¼šæ—¥å¿—æ‰“å°æ—¶åœ¨ç»ˆç«¯ä¸­çš„é…è‰²ã€‚
  - `icon`ï¼šLoguru ä¼šåœ¨æ§åˆ¶å°æ‰“å°è¯¥å›¾æ ‡ã€‚

#### 6. å¦‚ä½•åœ¨è¿œç¨‹æ”¶é›†ä¸­æ·»åŠ é‰´æƒä¿¡æ¯ï¼Ÿ
- åœ¨ `_send_to_remote` æ–¹æ³•é‡Œï¼Œå¯åœ¨ `headers` ä¸­æ·»åŠ  `Authorization` token æˆ–å…¶ä»–è‡ªå®šä¹‰è¯·æ±‚å¤´ã€‚

